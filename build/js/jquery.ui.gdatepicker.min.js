if(typeof $.widget!=="function"){throw new Error("Plugin requires jQuery UI Widget Factory (http://jqueryui.com/widget/)")}$.widget("simey.gdatepicker",{options:{placeholder:"Pick a date...",selected:"",format:"dd-MM-yyyy",formatOutput:"MMM dSX, yyyy",days:["M","T","W","T","F","S","S"],position:[3,0],scrollSpeed:300,overlayType:"both",overlayAnimation:"drop",theme:false},_create:function(){function t(){if(e.options.theme){return"ui-gdatepicker-theme-"+e.options.theme}}var e=this;if($.type(Date.today)==="undefined"){this._destroy();throw new Error("Date.js Library (http://www.datejs.com/) is required for date handling. Destroying gdatepicker.");return false}if(typeof $.ui.position===undefined){throw new Error("Plugin requires jQuery UI Position (http://jqueryui.com/position/)")}this._active={month:Date.today().getMonth(),year:Date.today().getFullYear()};this._$picker=$('<div class="ui-gdatepicker"/>').attr("id","gdatepicker_"+this.uuid).addClass(t());this._$pickerInner=$('<div class="ui-gdatepicker-wrapper"/>').appendTo(this._$picker);this._$pickerHead=$('<div class="ui-gdatepicker-head"/>').appendTo(this._$pickerInner);this._$pickerBody=$('<div class="ui-gdatepicker-body"/>').appendTo(this._$pickerInner);this._$pickerUpArrow=$('<div class="ui-gdatepicker-scroll-arrow ui-gdatepicker-scroll-arrow-up"><span>previous month</span></div>').appendTo(this._$pickerInner);this._$pickerDownArrow=$('<div class="ui-gdatepicker-scroll-arrow ui-gdatepicker-scroll-arrow-down"><span>next month</span></div>').appendTo(this._$pickerInner);this._$pickerUpArrowYear=$('<div class="ui-gdatepicker-scroll-arrow-year ui-gdatepicker-scroll-arrow-up-year"><span>previous year</span></div>').appendTo(this._$pickerInner);this._$pickerDownArrowYear=$('<div class="ui-gdatepicker-scroll-arrow-year ui-gdatepicker-scroll-arrow-down-year"><span>next year</span></div>').appendTo(this._$pickerInner);this._$pickerDateOverlay=$('<div class="ui-gdatepicker-overlay">'+(new Date(this._active.year,this._active.month,1)).toString("MMMM")+" "+this._active.year+"</div>").appendTo(this._$pickerInner);this._$pickerClose=$('<div class="ui-gdatepicker-close">Close</div>').appendTo(this._$pickerInner);this._$pickerElement=this.element.addClass("has-gdatepicker");this._$pickerInput=$('<input class="ui-gdatepicker-input" type="text"/>').attr("id","gdatepicker_"+this.uuid).addClass(t());this._$pickerEmpty=$('<span class="ui-gdatepicker-empty"><span>Clear</span></span>').addClass(t());this._generateHead();this._generateBody(this._active.month,this._active.year);this._$picker.appendTo($("body"));if(this.element.attr("placeholder")!==undefined){this._setOption("placeholder",this._$pickerElement.attr("placeholder"))}this._$pickerInput.prop("placeholder",this.options.placeholder).insertAfter(this._$pickerElement).after(this._$pickerEmpty);this._slctd={};this._slctd.value=this._$pickerElement.val();this._slctd.format=this.options.format;if(this._slctd.value!==""&&Date.parseExact(this._slctd.value,this._slctd.format)!==null){this._slctd.day=Date.parseExact(this._slctd.value,this._slctd.format).getDate();this._slctd.month=Date.parseExact(this._slctd.value,this._slctd.format).getMonth();this._slctd.year=Date.parseExact(this._slctd.value,this._slctd.format).getFullYear();this._setOption("selected",[this._slctd.day,this._slctd.month,this._slctd.year]);this.selectDate()}this.positionEmpty();$(window).on("resize.gdatepicker",function(){e.reposition();e.positionEmpty()});this._$pickerBody.on("click",".ui-gdatepicker-day",function(t){e.selectDate($(t.target))});this._$pickerInput.on({click:function(e){},change:function(t){e._trigger("changeValue",t,{selected:e.options.selected})},mouseover:function(){e._$pickerEmpty.addClass("ui-gdatepicker-empty-hover")},mouseout:function(){e._$pickerEmpty.removeClass("ui-gdatepicker-empty-hover")},focus:function(t){if(!e._$picker.is(":visible")){e.showCalendar();e._trigger("show");e._$pickerInput.addClass("ui-gdatepicker-active")}},keydown:function(t){if(t.keyCode===9){e.hideCalendar();e._trigger("hide");e._$pickerInput.removeClass("ui-gdatepicker-active")}},keyup:function(t){if(t.keyCode==13){var n=Date.parse(e._$pickerInput.val());if($.type(n)==="date"){e.goToNewMonth(n.getMonth(),n.getFullYear());e.selectDate([n.getDate(),n.getMonth(),n.getFullYear()]);e.scrollToCurrentDate()}else{e._trigger("invalidDate","keyup",{value:e._$pickerInput.val()})}}else{if(e._$pickerInput.val()===""){e._$pickerElement.val("");e._setOption("selected","")}}}});e._$pickerEmpty.on("click",function(t){e._$pickerElement.val("");e._$pickerInput.val("");e._setOption("selected","");e._highlightDate();e._trigger("clearInput","click",{target:e._$pickerEmpty,input:e._$pickerInput,originalInput:e._$pickerElement});t.preventDefault()});$("html").on("click",function(t){var n=$(t.target);if(e._$picker.is(":visible")){var r=$(e._$picker).add(e._$picker.find("*:not(.ui-gdatepicker-close)")).add(e._$pickerEmpty).add(e._$pickerInput).add(e._$pickerElement);if(r.filter(n).length<1){e.hideCalendar();e._trigger("hide");e._$pickerInput.removeClass("ui-gdatepicker-active")}}});this._$pickerUpArrow.on("click",function(t){var n=e._active.month-1;var r=e._active.year;if(n===-1){n=11;r--}e._trigger("changeMonth","click",{newMonth:n,newYear:r,previousMonth:e._active.month,previousYear:e._active.year,target:e._$pickerUpArrowYear});e.goToNewMonth(n,r)});this._$pickerUpArrowYear.on("click",function(t){var n=e._active.month;var r=e._active.year-1;e._trigger("changeYear","click",{newMonth:n,newYear:r,previousMonth:e._active.month,previousYear:e._active.year,target:e._$pickerUpArrowYear});e.goToNewMonth(n,r);e.showOverlay({direction:"up",type:"year"})});this._$pickerDownArrow.on("click",function(t){var n=e._active.month+1;var r=e._active.year;if(n===12){n=0;r++}e._trigger("changeMonth","click",{newMonth:n,newYear:r,previousMonth:e._active.month,previousYear:e._active.year,target:e._$pickerUpArrowYear});e.goToNewMonth(n,r)});this._$pickerDownArrowYear.on("click",function(t){var n=e._active.month;var r=e._active.year+1;e._trigger("changeYear","click",{newMonth:n,newYear:r,previousMonth:e._active.month,previousYear:e._active.year,target:e._$pickerUpArrowYear});e.goToNewMonth(n,r);e.showOverlay({direction:"down",type:"year"})});if($.event.special.mousewheel!==undefined){this._$picker.on("mousewheel",function(t,n){var r;t.preventDefault();if(n>0){if(t.shiftKey){e._$pickerUpArrowYear.trigger("click")}else{e._$pickerUpArrow.trigger("click")}r="up"}else if(n<0){if(t.shiftKey){e._$pickerDownArrowYear.trigger("click")}else{e._$pickerDownArrow.trigger("click")}r="down"}if(!t.shiftKey){e.showOverlay({direction:r,type:e.options.overlayType})}})}},showCalendar:function(){this._$picker.css({"z-index":999}).fadeIn(200);this.scrollToCurrentDate();this.reposition();if($.type(this.options.selected)==="array"){this.goToNewMonth(this.options.selected[1],this.options.selected[2],false)}else{this.goToNewMonth(Date.today().getMonth(),Date.today().getFullYear(),false)}},hideCalendar:function(){this._$picker.css({"z-index":""}).fadeOut(200)},showOverlay:function(e){if(this.options.overlayType){var t={duration:1e3,type:"both",direction:"up",animation:this.options.overlayAnimation,fadeout:.1,fadein:.3,fadelength:.6};$.extend(t,e);if(t.animation==="fade"){t.fadeout=t.fadein}if(t.direction==="up"){t.opposite="down"}else{t.opposite="up"}if(t.type==="month"){this._$pickerDateOverlay.text((new Date(this._active.year,this._active.month,1)).toString("MMMM"))}else if(t.type==="year"){this._$pickerDateOverlay.text(this._active.year)}else{this._$pickerDateOverlay.text((new Date(this._active.year,this._active.month,1)).toString("MMMM")+" "+this._active.year)}this._$pickerDateOverlay.stop(true,true).show(t.animation,{direction:t.direction,distance:20},t.duration*t.fadein);clearTimeout(this._otimer);this._otimer=setTimeout($.proxy(function(){this._$pickerDateOverlay.stop(true,true).hide(t.animation,{direction:t.opposite,distance:50},t.duration*t.fadeout)},this),t.duration*t.fadelength)}},reposition:function(e,t){var e=e||this.options.position[0];var t=t||this.options.position[1];this._$picker.position({my:"left+"+t+" top+"+e,at:"left bottom",of:this._$pickerInput})},positionEmpty:function(e,t){var e=e||0;var t=t||-10;this._$pickerEmpty.position({my:"right center",at:"right+"+t+" center+"+e,of:this._$pickerInput})},selectDate:function(e){if(e){if($.type(e)==="array"){this._setOption("selected",[e[0],e[1],e[2]])}else if($.type(e)==="object"){this._setOption("selected",[parseInt($(e).data("day")),parseInt($(e).data("month")),parseInt($(e).data("year"))])}else{throw new Error("Incorrect paramter: 'date' in function: selectDate();")}}this.updateInputs();this._highlightDate();this._trigger("selectDay","click",{date:new Date(this.options.selected[2],this.options.selected[1],this.options.selected[0]),formatted:this._$pickerInput.val()})},_highlightDate:function(){this._$pickerBody.find(".ui-gdatepicker-day").removeClass("ui-gdatepicker-selected");this._$pickerBody.find("[data-day="+this.options.selected[0]+"]"+"[data-month="+this.options.selected[1]+"]"+"[data-year="+this.options.selected[2]+"]").addClass("ui-gdatepicker-selected")},updateInputs:function(){if($.type(this.options.selected)==="array"){var e={};e.date=new Date(this.options.selected[2],this.options.selected[1],this.options.selected[0]);e.input=e.date.toString(this.options.format);e.output=e.date.toString(this.options.formatOutput).replace("SX",e.date.getOrdinal());this._$pickerInput.val(e.output);this._$pickerElement.val(e.input)}},scrollToCurrentDate:function(){var e=this._active.month;var t=this._active.year;var n=this._$picker.is(":hidden");if(n){this._$picker.css({display:"block",opacity:"0"})}var r=this._$pickerBody.find(".ui-gdatepicker-day:first").outerHeight();var i=this._$pickerBody.find("[data-month="+e+"][data-year="+t+"]").first().position().top;var s=this._$pickerBody.scrollTop();this._$pickerBody.scrollTop(s+i-r);if(n){this._$picker.css({display:"",opacity:""})}},goToNewMonth:function(e,t,n){var n=n===undefined?true:n;var r=this._active.month;var i=this._active.year;var s="down";if(r>e&&i===t||r<e&&i>t||r===e&&i>t){s="up"}var o=this.options.scrollSpeed;if((i>t||i<t)&&r===e){o=o/2}this._generateBody(e,t);this._highlightDate();this._active.month=e;this._active.year=t;if(n){this._scrollBody(s,o)}else{this.scrollToCurrentDate()}},_scrollBody:function(e,t){var n=this._active.month;var r=this._active.year;var i=n+1>11?0:n+1;var s=n+1>11?r+1:r;var t=t||this.options.scrollSpeed;var o=this._$pickerBody.find(".ui-gdatepicker-day:first").outerHeight();var u={to:this._$picker.find("[data-month="+n+"][data-year="+r+"]").first().position().top,from:this._$picker.find("[data-month="+i+"][data-year="+s+"]").first().position().top,now:this._$pickerBody.scrollTop()};var e=e||"down";var a=e==="down"?0:u.now+u.from-o;this._$pickerBody.scrollTop(a).stop().animate({scrollTop:u.now+u.to-o},t)},_destroy:function(){if(this._$picker!==undefined){this._$picker.empty().remove();this._$pickerInput.remove();this._$pickerEmpty.remove();this._$pickerElement.removeClass("has-gdatepicker");$(window).off("resize.gdatepicker")}},_setOption:function(e,t){this._super(e,t)},_generateBody:function(e,t){function r(e,t){var n="",r,i,s;if(e===0){r=11;i=t-1}else{r=e-1;i=t}s=Date.getDaysInMonth(i,r);var u=(new Date(t,e,1)).getDay();if(u===0){u=7}for(o=u-1;o>0;o--){var a=s-o+1;n+='<span class="ui-gdatepicker-day ui-gdatepicker-previous-month" data-day="'+a+'" data-year="'+i+'" data-month="'+r+'">';n+=a;n+="</span>"}return n}function i(e,t,n){var r="",i=t;for(mo=e;mo<e+n;mo++){var s=mo;if(mo>11){var s=mo-12;i=t+1}var o=(new Date(i,s,1)).toString("MMMM");var u=Date.today().getFullYear()!=i?i:"";var a=Date.getDaysInMonth(i,s);var f=(new Date(i,s,1)).getDay();if(f==0){f=7}for(d=1;d<=a;d++){var l=d==1&&f>1?"ui-gdatepicker-divider-left":"";var c=d<=7?"ui-gdatepicker-divider-top":"";var h=mo==e?"ui-gdatepicker-previous-month":"";r+='<span class="ui-gdatepicker-day '+l+" "+c+" "+h+'" data-day="'+d+'" data-year="'+i+'" data-month="'+s+'">';r+=d;r+="</span>";if((f+(d-1))%7==0){if(f+(d-1)<8){r+='<span class="ui-gdatepicker-monthname ui-gdatepicker-divider-top ui-gdatepicker-newline" data-year="'+i+'" data-month="'+s+'">'+o+" "+u+"</span><br>"}else{r+='<span class="ui-gdatepicker-newline"></span><br>'}}}}return r}var n="";if(typeof e!=="number"){var e=Date.today().getMonth()}if(typeof t!=="number"){var t=Date.today().getFullYear()}if(e===0){e=11;t-=1}else{e-=1}n+=r(e,t);n+=i(e,t,5);this._$pickerBody.empty().html(n)},_generateHead:function(){var e="";for(i=0;i<7;i++){e+='<span class="ui-gdatepicker-day" data-day="'+this.options.days[i]+'">';e+=this.options.days[i];e+="</span>"}this._$pickerHead.empty().html(e)}})
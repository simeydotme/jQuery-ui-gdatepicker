;if(typeof $.widget!=="function")throw new Error("Plugin requires jQuery UI Widget Factory (http://jqueryui.com/widget/)");
$.widget("simey.gdatepicker",{options:{placeholder:"Pick a date...",selected:"",format:"dd-MM-yyyy",formatOutput:"MMM dSX, yyyy",days:["M","T","W","T","F","S","S"],position:[3,0],scrollSpeed:300,overlayType:"both",overlayAnimation:"drop",theme:false},_create:function(){var mommy=this;if($.type(Date.today)==="undefined"){this._destroy();throw new Error("Date.js Library (http://www.datejs.com/) is required for date handling. Destroying gdatepicker.");return false}if(typeof $.ui.position===undefined)throw new Error("Plugin requires jQuery UI Position (http://jqueryui.com/position/)");
this._active={month:Date.today().getMonth(),year:Date.today().getFullYear()};function addTheme(){if(mommy.options.theme)return"ui-gdatepicker-theme-"+mommy.options.theme}this._$picker=$('<div class="ui-gdatepicker"/>').attr("id","gdatepicker_"+this.uuid).addClass(addTheme());this._$pickerInner=$('<div class="ui-gdatepicker-wrapper"/>').appendTo(this._$picker);this._$pickerHead=$('<div class="ui-gdatepicker-head"/>').appendTo(this._$pickerInner);this._$pickerBody=$('<div class="ui-gdatepicker-body"/>').appendTo(this._$pickerInner);
this._$pickerUpArrow=$('<div class="ui-gdatepicker-scroll-arrow ui-gdatepicker-scroll-arrow-up"><span>previous month</span></div>').appendTo(this._$pickerInner);this._$pickerDownArrow=$('<div class="ui-gdatepicker-scroll-arrow ui-gdatepicker-scroll-arrow-down"><span>next month</span></div>').appendTo(this._$pickerInner);this._$pickerUpArrowYear=$('<div class="ui-gdatepicker-scroll-arrow-year ui-gdatepicker-scroll-arrow-up-year"><span>previous year</span></div>').appendTo(this._$pickerInner);this._$pickerDownArrowYear=
$('<div class="ui-gdatepicker-scroll-arrow-year ui-gdatepicker-scroll-arrow-down-year"><span>next year</span></div>').appendTo(this._$pickerInner);this._$pickerDateOverlay=$('<div class="ui-gdatepicker-overlay">'+(new Date(this._active.year,this._active.month,1)).toString("MMMM")+" "+this._active.year+"</div>").appendTo(this._$pickerInner);this._$pickerClose=$('<div class="ui-gdatepicker-close">Close</div>').appendTo(this._$pickerInner);this._$pickerElement=this.element.addClass("has-gdatepicker");
this._$pickerInput=$('<input class="ui-gdatepicker-input" type="text"/>').attr("id","gdatepicker_"+this.uuid).addClass(addTheme());this._$pickerEmpty=$('<span class="ui-gdatepicker-empty"><span>Clear</span></span>').addClass(addTheme());this._generateHead();this._generateBody(this._active.month,this._active.year);this._$picker.appendTo($("body"));if(this.element.attr("placeholder")!==undefined)this._setOption("placeholder",this._$pickerElement.attr("placeholder"));this._$pickerInput.prop("placeholder",
this.options.placeholder).insertAfter(this._$pickerElement).after(this._$pickerEmpty);this._slctd={};this._slctd.value=this._$pickerElement.val();this._slctd.format=this.options.format;if(this._slctd.value!==""&&Date.parseExact(this._slctd.value,this._slctd.format)!==null){this._slctd.day=Date.parseExact(this._slctd.value,this._slctd.format).getDate();this._slctd.month=Date.parseExact(this._slctd.value,this._slctd.format).getMonth();this._slctd.year=Date.parseExact(this._slctd.value,this._slctd.format).getFullYear();
this._setOption("selected",[this._slctd.day,this._slctd.month,this._slctd.year]);this.selectDate()}$(window).on("resize.gdatepicker",function(){mommy.reposition()});this._$pickerBody.on("click",".ui-gdatepicker-day",function(e){mommy.selectDate($(e.target))});this._$pickerInput.on("click",function(e){}).on("change",function(e){mommy._trigger("changeValue",e,{selected:mommy.options.selected})}).on("mouseover",function(){mommy._$pickerEmpty.addClass("ui-gdatepicker-empty-hover")}).on("mouseout",function(){mommy._$pickerEmpty.removeClass("ui-gdatepicker-empty-hover")}).on("focus",
function(e){if(!mommy._$picker.is(":visible")){mommy.showCalendar();mommy._trigger("show");mommy._$pickerInput.addClass("ui-gdatepicker-active")}}).on("keydown",function(e){if(e.keyCode===9){mommy.hideCalendar();mommy._trigger("hide");mommy._$pickerInput.removeClass("ui-gdatepicker-active")}}).on("keyup",function(e){if(e.keyCode==13){var str=Date.parse(mommy._$pickerInput.val());if($.type(str)==="date"){mommy.goToNewMonth(str.getMonth(),str.getFullYear());mommy.selectDate([str.getDate(),str.getMonth(),
str.getFullYear()]);mommy.scrollToCurrentDate()}else mommy._trigger("invalidDate","keyup",{value:mommy._$pickerInput.val()})}else if(mommy._$pickerInput.val()===""){mommy._$pickerElement.val("");mommy._setOption("selected","")}});mommy._$pickerEmpty.on("click",function(e){mommy._$pickerElement.val("");mommy._$pickerInput.val("");mommy._setOption("selected","");mommy._highlightDate();mommy._trigger("clearInput","click",{target:mommy._$pickerEmpty,input:mommy._$pickerInput,originalInput:mommy._$pickerElement});
e.preventDefault()});$("html").on("click",function(e){var $target=$(e.target);if(mommy._$picker.is(":visible")){var $els=$(mommy._$picker).add(mommy._$picker.find("*:not(.ui-gdatepicker-close)")).add(mommy._$pickerEmpty).add(mommy._$pickerInput).add(mommy._$pickerElement);if($els.filter($target).length<1){mommy.hideCalendar();mommy._trigger("hide");mommy._$pickerInput.removeClass("ui-gdatepicker-active")}}});this._$pickerUpArrow.on("click",function(e){var m=mommy._active.month-1;var y=mommy._active.year;
if(m===-1){m=11;y--}mommy._trigger("changeMonth","click",{newMonth:m,newYear:y,previousMonth:mommy._active.month,previousYear:mommy._active.year,target:mommy._$pickerUpArrowYear});mommy.goToNewMonth(m,y)});this._$pickerUpArrowYear.on("click",function(e){var m=mommy._active.month;var y=mommy._active.year-1;mommy._trigger("changeYear","click",{newMonth:m,newYear:y,previousMonth:mommy._active.month,previousYear:mommy._active.year,target:mommy._$pickerUpArrowYear});mommy.goToNewMonth(m,y);mommy.showOverlay({direction:"up",
type:"year"})});this._$pickerDownArrow.on("click",function(e){var m=mommy._active.month+1;var y=mommy._active.year;if(m===12){m=0;y++}mommy._trigger("changeMonth","click",{newMonth:m,newYear:y,previousMonth:mommy._active.month,previousYear:mommy._active.year,target:mommy._$pickerUpArrowYear});mommy.goToNewMonth(m,y)});this._$pickerDownArrowYear.on("click",function(e){var m=mommy._active.month;var y=mommy._active.year+1;mommy._trigger("changeYear","click",{newMonth:m,newYear:y,previousMonth:mommy._active.month,
previousYear:mommy._active.year,target:mommy._$pickerUpArrowYear});mommy.goToNewMonth(m,y);mommy.showOverlay({direction:"down",type:"year"})});if($.event.special.mousewheel!==undefined)this._$picker.on("mousewheel",function(e,delta){var direction;e.preventDefault();if(delta>0){if(e.shiftKey)mommy._$pickerUpArrowYear.trigger("click");else mommy._$pickerUpArrow.trigger("click");direction="up"}else if(delta<0){if(e.shiftKey)mommy._$pickerDownArrowYear.trigger("click");else mommy._$pickerDownArrow.trigger("click");
direction="down"}if(!e.shiftKey)mommy.showOverlay({direction:direction,type:mommy.options.overlayType})})},showCalendar:function(){this._$picker.css({"z-index":999}).fadeIn(200);this.scrollToCurrentDate();this.reposition();if($.type(this.options.selected)==="array")this.goToNewMonth(this.options.selected[1],this.options.selected[2],false);else this.goToNewMonth(Date.today().getMonth(),Date.today().getFullYear(),false)},hideCalendar:function(){this._$picker.css({"z-index":""}).fadeOut(200)},showOverlay:function(settings){if(this.options.overlayType){var options=
{duration:1E3,type:"both",direction:"up",animation:this.options.overlayAnimation,fadeout:0.1,fadein:0.3,fadelength:0.6};$.extend(options,settings);if(options.animation==="fade")options.fadeout=options.fadein;if(options.direction==="up")options.opposite="down";else options.opposite="up";if(options.type==="month")this._$pickerDateOverlay.text((new Date(this._active.year,this._active.month,1)).toString("MMMM"));else if(options.type==="year")this._$pickerDateOverlay.text(this._active.year);else this._$pickerDateOverlay.text((new Date(this._active.year,
this._active.month,1)).toString("MMMM")+" "+this._active.year);this._$pickerDateOverlay.stop(true,true).show(options.animation,{direction:options.direction,distance:20},options.duration*options.fadein);clearTimeout(this._otimer);this._otimer=setTimeout($.proxy(function(){this._$pickerDateOverlay.stop(true,true).hide(options.animation,{direction:options.opposite,distance:50},options.duration*options.fadeout)},this),options.duration*options.fadelength)}},reposition:function(top,left){var top=top||this.options.position[0];
var left=left||this.options.position[1];this._$picker.position({my:"left+"+left+" top+"+top,at:"left bottom",of:this._$pickerInput})},selectDate:function(date){if(date)if($.type(date)==="array")this._setOption("selected",[date[0],date[1],date[2]]);else if($.type(date)==="object")this._setOption("selected",[parseInt($(date).data("day")),parseInt($(date).data("month")),parseInt($(date).data("year"))]);else throw new Error("Incorrect paramter: 'date' in function: selectDate();");this.updateInputs();
this._highlightDate();this._trigger("selectDay","click",{date:new Date(this.options.selected[2],this.options.selected[1],this.options.selected[0]),formatted:this._$pickerInput.val()})},_highlightDate:function(){this._$pickerBody.find(".ui-gdatepicker-day").removeClass("ui-gdatepicker-selected");this._$pickerBody.find("[data-day="+this.options.selected[0]+"]"+"[data-month="+this.options.selected[1]+"]"+"[data-year="+this.options.selected[2]+"]").addClass("ui-gdatepicker-selected")},updateInputs:function(){if($.type(this.options.selected)===
"array"){var vals={};vals.date=new Date(this.options.selected[2],this.options.selected[1],this.options.selected[0]);vals.input=vals.date.toString(this.options.format);vals.output=vals.date.toString(this.options.formatOutput).replace("SX",vals.date.getOrdinal());this._$pickerInput.val(vals.output);this._$pickerElement.val(vals.input)}},scrollToCurrentDate:function(){var m=this._active.month;var y=this._active.year;var trick=this._$picker.is(":hidden");if(trick)this._$picker.css({display:"block",opacity:"0"});
var h=this._$pickerBody.find(".ui-gdatepicker-day:first").outerHeight();var scrolltop=this._$pickerBody.find("[data-month="+m+"][data-year="+y+"]").first().position().top;var currenttop=this._$pickerBody.scrollTop();this._$pickerBody.scrollTop(currenttop+scrolltop-h);if(trick)this._$picker.css({display:"",opacity:""})},goToNewMonth:function(month,year,scroll){var scroll=scroll===undefined?true:scroll;var om=this._active.month;var oy=this._active.year;var direction="down";if(om>month&&oy===year||om<
month&&oy>year||om===month&&oy>year)direction="up";var duration=this.options.scrollSpeed;if((oy>year||oy<year)&&om===month)duration=duration/2;this._generateBody(month,year);this._highlightDate();this._active.month=month;this._active.year=year;if(scroll)this._scrollBody(direction,duration);else this.scrollToCurrentDate()},_scrollBody:function(direction,duration){var m=this._active.month;var y=this._active.year;var nm=m+1>11?0:m+1;var ny=m+1>11?y+1:y;var duration=duration||this.options.scrollSpeed;
var h=this._$pickerBody.find(".ui-gdatepicker-day:first").outerHeight();var opt={to:this._$picker.find("[data-month="+m+"][data-year="+y+"]").first().position().top,from:this._$picker.find("[data-month="+nm+"][data-year="+ny+"]").first().position().top,now:this._$pickerBody.scrollTop()};var direction=direction||"down";var offset=direction==="down"?0:opt.now+opt.from-h;this._$pickerBody.scrollTop(offset).stop().animate({scrollTop:opt.now+opt.to-h},duration)},_destroy:function(){if(this._$picker!==
undefined){this._$picker.empty().remove();this._$pickerInput.remove();this._$pickerEmpty.remove();this._$pickerElement.removeClass("has-gdatepicker")}},_setOption:function(key,value){this._super(key,value)},_generateBody:function(month,year){var html="";if(typeof month!=="number")var month=Date.today().getMonth();if(typeof year!=="number")var year=Date.today().getFullYear();if(month===0){month=11;year-=1}else month-=1;function previousDays(month,year){var html="",previousMonth,previousMonthYear,daysInPreviousMonth;
if(month===0){previousMonth=11;previousMonthYear=year-1}else{previousMonth=month-1;previousMonthYear=year}daysInPreviousMonth=Date.getDaysInMonth(previousMonthYear,previousMonth);var offset=(new Date(year,month,1)).getDay();if(offset===0)offset=7;for(o=offset-1;o>0;o--){var oday=daysInPreviousMonth-o+1;html+='<span class="ui-gdatepicker-day ui-gdatepicker-previous-month" data-day="'+oday+'" data-year="'+previousMonthYear+'" data-month="'+previousMonth+'">';html+=oday;html+="</span>"}return html}function addMonths(month,
year,howMany){var html="",y=year;for(mo=month;mo<month+howMany;mo++){var m=mo;if(mo>11){var m=mo-12;y=year+1}var monthname=(new Date(y,m,1)).toString("MMMM");var yearname=Date.today().getFullYear()!=y?y:"";var daysInMonth=Date.getDaysInMonth(y,m);var offset=(new Date(y,m,1)).getDay();if(offset==0)offset=7;for(d=1;d<=daysInMonth;d++){var filler=d==1&&offset>1?"ui-gdatepicker-divider-left":"";var divider=d<=7?"ui-gdatepicker-divider-top":"";var previous=mo==month?"ui-gdatepicker-previous-month":"";
html+='<span class="ui-gdatepicker-day '+filler+" "+divider+" "+previous+'" data-day="'+d+'" data-year="'+y+'" data-month="'+m+'">';html+=d;html+="</span>";if((offset+(d-1))%7==0)if(offset+(d-1)<8)html+='<span class="ui-gdatepicker-monthname ui-gdatepicker-divider-top ui-gdatepicker-newline" data-year="'+y+'" data-month="'+m+'">'+monthname+" "+yearname+"</span><br>";else html+='<span class="ui-gdatepicker-newline"></span><br>'}}return html}html+=previousDays(month,year);html+=addMonths(month,year,
5);this._$pickerBody.empty().html(html)},_generateHead:function(){var html="";for(i=0;i<7;i++){html+='<span class="ui-gdatepicker-day" data-day="'+this.options.days[i]+'">';html+=this.options.days[i];html+="</span>"}this._$pickerHead.empty().html(html)}});
